{% extends "base.html" %}
{% block title %}Wyszukiwarka zgon√≥w{% endblock %}

{% block content %}
<div class="row g-4 align-items-start">
  <!-- LEWA KOLUMNA: WYSZUKIWARKA + INFORMACJA -->
  <div class="col-lg-5">
    <div class="card shadow-sm border-0">
      <div class="card-body p-4">
        <h1 class="h4 mb-1">Wyszukiwarka</h1>
        <p class="text-muted mb-4">
          Wpisz imiƒô i nazwisko (mo≈ºe byƒá fragment). Wyniki sƒÖ niewra≈ºliwe na wielko≈õƒá liter.
        </p>

        <form method="post" action="/search" class="needs-validation" novalidate>
          <label class="form-label fw-semibold">Imiƒô i nazwisko</label>
          <div class="input-group input-group-lg">
            <input
              type="text"
              name="query"
              class="form-control"
              placeholder="np. J√≥zefa Bubelnik"
              value="{{ query or '' }}"
            >
            <button class="btn btn-primary" type="submit">Szukaj</button>
          </div>


            <!-- NOWE POLE: PARAFIA -->
  <label class="form-label fw-semibold mt-3">Parafia</label>
  <select name="parafia" class="form-select">
    <option value="">Wybierz wszystkie parafie</option>
    {% for p in parishes %}
      <option value="{{ p }}" {% if selected_parafia == p %}selected{% endif %}>
        {{ p }}
      </option>
    {% endfor %}
  </select>

          <div class="invalid-feedback">
            Podaj przynajmniej jedno imiƒô lub nazwisko.
          </div>
        </form>

        <div class="mt-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span class="fw-semibold">Wyniki</span>
            {% if results is not none %}
              <span class="badge text-bg-dark rounded-pill">{{ results|length }}</span>
            {% endif %}
          </div>

          {% if results is not none %}
            {% if results|length == 0 %}
              <div class="alert alert-warning mt-2 mb-0">
                Brak wynik√≥w dla: <strong>{{ query }}</strong>
              </div>
            {% else %}
              <div class="alert alert-success mt-2 mb-0">
                Znaleziono rekord√≥w: <strong>{{ results|length }}</strong>
              </div>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>

    <div class="card border-0 mt-4 info-card">
      <div class="card-body p-4">
        <div class="fw-semibold mb-2">Informacja</div>
        <div class="text-muted small">
          Dane pochodzƒÖ z akt parafialnych, protoko≈Ç√≥w zgon√≥w oraz rejestr√≥w ludno≈õci.
          Wpisy mogƒÖ posiadaƒá braki, nadpisy lub skr√≥ty w≈Ça≈õciwe dla epoki.
        </div>
      </div>
    </div>
  </div>

  <!-- PRAWA KOLUMNA: REKORDY -->
  <div class="col-lg-7">
    <div class="card shadow-sm border-0 records-panel">
      <div class="card-body p-0">
        <div class="records-header p-4 border-bottom">
          <div class="d-flex align-items-center justify-content-between">
            <h2 class="h5 mb-0">REKORDY</h2>
            <div class="text-muted small">
              {% if results is none %}
                Wykonaj wyszukiwanie.
              {% else %}
                Wy≈õwietlam: {{ results|length }}
              {% endif %}
            </div>
          </div>
        </div>

        {% if results %}
          <div class="records-list p-3">
            {% for r in results %}
            <article class="record-card mb-3">
                <header class="record-card-header">
                  <div class="record-id">#{{ r.id }}</div>
                  <div class="record-name">{{ r.imie_nazwisko }}</div>

                  {% if r.image_url %}
                    <div class="record-source small">
                      <a href="{{ r.image_url }}" target="_blank" class="text-muted">
                        Zobacz skan
                      </a>
                    </div>
                  {% endif %}
                </header>


             <div class="record-card-body">
  <div class="record-field">
    <div class="record-label">WIEK</div>
    <div class="record-value">
      {{ r.wiek or "brak danych" }}
    </div>
  </div>

  <div class="record-field">
    <div class="record-label">MIEJSCE URODZENIA</div>
    <div class="record-value">
      {{ r.miejsce_urodzenia or "brak informacji" }}
    </div>
  </div>

  <div class="record-field">
    <div class="record-label">PARAFIA</div>
    <div class="record-value">
      {{ r.parafia or "brak informacji" }}
    </div>
  </div>

  <div class="record-field">
    <div class="record-label">DATA ZGONU</div>
    <div class="record-value">
      {{ r.data_zgonu or "brak danych" }}
    </div>
  </div>

  <div class="record-field">
    <div class="record-label">PRZYCZYNA ZGONU</div>
    <div class="record-value">
      {{ r.przyczyna_zgonu or "brak danych" }}
    </div>
  </div>

  <div class="record-field record-field-wide">
    <div class="record-label">INNE WA≈ªNE INFORMACJE</div>
    <div class="record-value">
      {{ r.inne_wazne_informacje or "‚Äî" }}
    </div>
  </div>
</div>

            </article>
            {% endfor %}
          </div>
        {% else %}
          <div class="p-4">
            <div class="empty-state">
              <div class="display-6 mb-2">üîé</div>
              <div class="fw-semibold">Brak danych do wy≈õwietlenia</div>
              <div class="text-muted">Wpisz imiƒô i nazwisko i kliknij ‚ÄûSzukaj‚Äù.</div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  'use strict';
  const forms = document.querySelectorAll('.needs-validation');
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
})();
</script>
{% endblock %}
